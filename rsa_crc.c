#include <stdint.h>
#include <stdio.h>
#include "rsa_num.h"

static u64 crc64_table[256] = {
	(u64)0x60c6697351ff4a, (u64)0xe029cdbaabf2fb,
	(u64)0xe0467cc254f81b, (u64)0xe0e78d765a2e63,
	(u64)0x309fc99a66320d, (u64)0xb03158a35a255d,
	(u64)0x1058e95ed4abb2, (u64)0xc0c69bb454110e,
	(u64)0x807441213ddc87, (u64)0x70e93ea141e1fc,
	(u64)0x603e017e97eadc, (u64)0x60968f385c2aec,
	(u64)0xb03bfb32af3c54, (u64)0xe018db5c021afe,
	(u64)0x40fbfaaa3afb29, (u64)0xd0e6053c7c9475,
	(u64)0xd0be6189f95cbb, (u64)0xa0990f95b1ebf1,
	(u64)0xb005eff700e9a1, (u64)0x30e5ca0bcbd048,
	(u64)0x4064bd1f231ea8, (u64)0x107b64c514735a,
	(u64)0xc05e4b79633b70, (u64)0x6024119e09dcaa,
	(u64)0xd0acf21b10af3b, (u64)0x30cde350484715,
	(u64)0x50bb6f2219ba9b, (u64)0x70f50be11a1c7f,
	(u64)0x20f829f8a41b13, (u64)0xb0ca4ee8983238,
	(u64)0xe0794d3d34bc5f, (u64)0x4077facb6c05ac,
	(u64)0x80212baa1a55a2, (u64)0xb070b5733b045c,
	(u64)0xd03694b3afe2f0, (u64)0xe09e4f321549fd,
	(u64)0x804ea90870d4b2, (u64)0x802954489a0abc,
	(u64)0xd00e18a844ac5b, (u64)0xf08e4cd72d9b09,
	(u64)0x40e506c433afcd, (u64)0xa0847f2dadd476,
	(u64)0x40de321cec4ac4, (u64)0x30f62023856cfb,
	(u64)0xb00704f4ec0bb9, (u64)0x20ba86c33e05f1,
	(u64)0xe0d96733b79950, (u64)0xa0e314d3d934f7,
	(u64)0x50a0f210a8f605, (u64)0x9001beb4bc4478,
	(u64)0xf04969e623d01a, (u64)0xd0696a7e4c7e51,
	(u64)0x20b34884533a94, (u64)0xf0319990325744,
	(u64)0xe09bbce9e525cf, (u64)0xf0e9e25e5360aa,
	(u64)0xd0b2d085fa54d8, (u64)0x30e8d466826498,
	(u64)0xd0a8877565705a, (u64)0x803f62802944de,
	(u64)0x70a5894e5759d3, (u64)0x50adac869580ec,
	(u64)0x10e485f18c0c66, (u64)0xf07cc07cbb22fc,
	(u64)0xe066da610b63af, (u64)0x60bc83b4692f3a,
	(u64)0xf0af271693ac07, (u64)0x10b86d11342d8d,
	(u64)0xe04f89d4b66335, (u64)0xc0c7e4248367d8,
	(u64)0xe09612ec453902, (u64)0xd0e50af89d7709,
	(u64)0xd0a596c1f41f95, (u64)0xa082ca6c49ae90,
	(u64)0xc01668baac7aa6, (u64)0xf0b4a8ca99b2c2,
	(u64)0x302acb08cf61c9, (u64)0xc0805e6e0328da,
	(u64)0x40d76a19edd2d3, (u64)0x904c798b002256,
	(u64)0x90d418d1fee4d9, (u64)0xc045a391c601ff,
	(u64)0xc02ad91501432f, (u64)0xe0150287617c13,
	(u64)0x609e69fc7281cd, (u64)0x7065a63eab49cf,
	(u64)0x704bce3a75a74f, (u64)0x70ea7e64ff81eb,
	(u64)0x60fdfec39b67bf, (u64)0xe08c7e4e32bdf9,
	(u64)0x708c6ac75ba43c, (u64)0xf0b2ed7216ecf3,
	(u64)0x40f000108b67cf, (u64)0x90505b179f8ed4,
	(u64)0x900a6103d1bca7, (u64)0xb09bbfab0ed598,
	(u64)0xd0e5f2d6f67d3e, (u64)0xc0168e212e2daf,
	(u64)0xc0b963c98a1f70, (u64)0x90de0c56891a2b,
	(u64)0x201b01070dd8fd, (u64)0x8016c2a1a4e3cf,
	(u64)0xd092d2984b3561, (u64)0xd055d16c33ddc2,
	(u64)0xb0f7edde13efe5, (u64)0x20c7e2abdda44d,
	(u64)0x80881c531aeeeb, (u64)0x60244c3b791ea8,
	(u64)0xa0fb6a68f35846, (u64)0x402b260e0dd2eb,
	(u64)0xb01f6c3a3bc054, (u64)0x20abba4ef8f6c7,
	(u64)0x109e731108db04, (u64)0x60220aa74d31b5,
	(u64)0x5003a00d220d47, (u64)0x50cd9b877856d5,
	(u64)0x704c9c86ea0f98, (u64)0xf0eb9c530da7fa,
	(u64)0x50d8b0b5db50c2, (u64)0xf05d095a2aa5e2,
	(u64)0xa0fbb71347549a, (u64)0x306332234ece76,
	(u64)0x507571b64d216b, (u64)0x20712e25cf3780,
	(u64)0xf0dc629cd719b0, (u64)0x106d4a4fd17c73,
	(u64)0x104ae97bc05a31, (u64)0x709c36edca5bbc,
	(u64)0xd0b5de3d52b657, (u64)0xd0c44c2495c897,
	(u64)0xb0128030d2db61, (u64)0xe056fd1643c871,
	(u64)0xf0ca4db5a88a07, (u64)0x50e10933a65557,
	(u64)0x301deef02f6e20, (u64)0x4081e2a07ff8e3,
	(u64)0x4069e311b698b9, (u64)0x409f1822a84bc8,
	(u64)0xf0a2041a90f449, (u64)0xf0154b48962de8,
	(u64)0x1025cb5c8fae6d, (u64)0x40462786e53fa9,
	(u64)0x808a718a2c75a4, (u64)0xb06aeeba7f3902,
	(u64)0x1067ea2b8cb687, (u64)0x1064f561ab1ce7,
	(u64)0x905b901ee502a8, (u64)0x10774dcde13b87,
	(u64)0x60748a76db74a1, (u64)0x602a28838f1de4,
	(u64)0x3039ccca945ce8, (u64)0x705e918ad6de57,
	(u64)0xb019df188d698e, (u64)0x60dd2fd1085754,
	(u64)0x907539d1ae059b, (u64)0x406184bcc01547,
	(u64)0x90f39e4d0c7d65, (u64)0x90e6f302c422d3,
	(u64)0xc07a2863ef6134, (u64)0x9066cfe0c7539d,
	(u64)0x8068e41d5b826b, (u64)0x6000d001e6c403,
	(u64)0xa0e6d77660ffd9, (u64)0x40600dedc6ddcd,
	(u64)0x80306a15994e32, (u64)0xf0d19d5cd16e5d,
	(u64)0xb03260621837d8, (u64)0x7036b2c896bfb5,
	(u64)0x509c83eacdedff, (u64)0x603c315a0dcfb6,
	(u64)0xd03d13956f74f7, (u64)0x80abd000e282c9,
	(u64)0x70417ed5de01bf, (u64)0xa0efbe112bef6b,
	(u64)0x30be2216fb35ab, (u64)0x60a9a3f25573f2,
	(u64)0x30f5bbaf363a84, (u64)0x103b43bf2a01d0,
	(u64)0x50f13c8daf5ea3, (u64)0xa0934f153df207,
	(u64)0x9065fac95ab578, (u64)0x90effda52b4064,
	(u64)0x504235ab337138, (u64)0xe0cfdc8d622ba3,
	(u64)0x901daa3182a4fa, (u64)0xd05a736c497011,
	(u64)0x70b076caf2ab75, (u64)0x201cad08eb8995,
	(u64)0x40b438edd1e31e, (u64)0x5087192fe18c9c,
	(u64)0x20fcad9fac2369, (u64)0x90cedec4ea8ccc,
	(u64)0xd0156223ca9a10, (u64)0x907d2eef05471e,
	(u64)0xe0d3ba11cf68b1, (u64)0x708b1a1b5af9df,
	(u64)0x4085ac1a9a0e3d, (u64)0x60a84d00267bef,
	(u64)0x20c30d1196c823, (u64)0x6030d4e2bbeefd,
	(u64)0x10e7dc5a6c8874, (u64)0x90b16b3ffe6b65,
	(u64)0x705a903c68a1d3, (u64)0x30c43960981b1b,
	(u64)0x8018316ef48bdb, (u64)0x70ffe213b04d52,
	(u64)0xa0b9b727134764, (u64)0x70e937abad700b,
	(u64)0x408b27cda3583b, (u64)0x90e31614e2f828,
	(u64)0x90467a40ff3267, (u64)0x1079cb8e620239,
	(u64)0x10724556fd6c23, (u64)0xa0c45e38a7754c,
	(u64)0x806d741bb3ef5b, (u64)0xb021c2c59a8e53,
	(u64)0xf0908c0d03d163, (u64)0x3086a101e4d9a8,
	(u64)0x502531c79a4c7a, (u64)0x80a72daa6af244,
	(u64)0xf0454188d14e8b, (u64)0xa0b18ce0372de2,
	(u64)0x10068a752bbc3c, (u64)0xc008b74eb0e4f8,
	(u64)0x10d63d121b7e9a, (u64)0xe0cd268f7eb270,
	(u64)0xb0df52d2e5dc47, (u64)0x109884d6a13b24,
	(u64)0x501f1d6bf55a7d, (u64)0x10d817fca53d8c,
	(u64)0x20effcdace4eac, (u64)0xb02af3c4c3779a,
	(u64)0x60b2beb5d1db20, (u64)0xc0359dd60eb4d3,
	(u64)0xb0f25fd7e15bb1, (u64)0xb0a95d63d35127,
	(u64)0x90c8c1fa7b80af, (u64)0x405bcf13916ce9,
	(u64)0x9021bc52131b2a, (u64)0xf076dba41f3908,
	(u64)0xf08a2f8952f184, (u64)0xc071331acc032d,
	(u64)0x506f16fc90d34f, (u64)0xa0ee799865543c,
	(u64)0x808d4477177401, (u64)0x60658537d6b851,
	(u64)0xa0bb7e002b95fc, (u64)0xb0684b5f56c4f7,
	(u64)0xb0193340a678b7, (u64)0xb0ecb828513d5f,
	(u64)0x20f6b1c9b12fc9, (u64)0xd0c4c6982c11f7,
	(u64)0x80d6ee3eef217e, (u64)0x9099365385ee7b,
	(u64)0xd02cdbfd228cc7, (u64)0xd0bb90b0805648,
};

u64 __crc64(u64 crc, char *str, size_t len)
{
	size_t i;

	for (i = 0; i < len; i++) {
		crc = crc64_table[(unsigned char)crc ^ (unsigned char)str[i]] ^
			(crc >> 8);
	}

	return crc;
}

u64 rsa_crc(char *str, size_t len)
{
	return __crc64((u64)0xffffffffffffffff, str, len);
}
